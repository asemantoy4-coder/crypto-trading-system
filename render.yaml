services:
  - type: web
    name: crypto-trading-system
    env: python
    region: frankfurt
    plan: free
    
    # ساختار پوشه
    rootDirectory: .
    
    # Build command
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    
    # Start command
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    
    # Health check
    healthCheckPath: /api/health
    healthCheckTimeout: 30
    
    # Auto deployment
    autoDeploy: true
    pullRequestPreviewsEnabled: false
    
    # Environment variables
    envVars:
      - key: PYTHONUNBUFFERED
        value: "true"
      - key: PYTHON_VERSION
        value: "3.10.12"
      - key: ENVIRONMENT
        value: "production"
      - key: LOG_LEVEL
        value: "INFO"
    
    # Disk (برای cache کردن داده‌ها اگر نیاز باشد)
    disk:
      name: data
      mountPath: /data
      sizeGB: 1
    
    # Advanced settings
    dockerCommand: null
    dockerContext: null
    dockerfilePath: null
    
    # Plan-specific settings
    instanceCount: 1
    
    # CORS settings (اگر frontend دارید)
    headers:
      - path: /*
        name: Access-Control-Allow-Origin
        value: "*"
      - path: /*
        name: Access-Control-Allow-Methods
        value: "GET, POST, PUT, DELETE, OPTIONS"
      - path: /*
        name: Access-Control-Allow-Headers
        value: "Content-Type, Authorization"
    
    # Redirects (اگر نیاز باشد)
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
        when:
          status: 404
    
    # Monitoring
    alerts:
      - rule: DEPLOYMENT_FAILED
      - rule: CPU_UTILIZATION
        value: 80
      - rule: MEM_UTILIZATION
        value: 80
    
    # Secrets (اگر API keys دارید)
    # envVarGroups:
    #   - group: binance-keys
    #     name: binance
    #     valueFrom:
    #       secretKeyRef:
    #         name: binance-secrets
    #         key: api-key
    
    # Build settings
    buildFilter:
      paths:
        - "**.py"
        - "requirements.txt"
        - "runtime.txt"
        - "render.yaml"
      ignoredPaths:
        - "tests/**"
        - "**/*.log"
        - "**/__pycache__/**"
    
    # Deployment hooks (اختیاری)
    # preDeployCommand: python scripts/pre_deploy.py
    # postDeployCommand: python scripts/post_deploy.py
    
    # Scaling (برای Free tier فقط 1)
    scaling:
      minInstances: 1
      maxInstances: 1
      targetMemoryPercent: 70
      targetCPUPercent: 70
    
    # Network
    network:
      - port: 10000
        protocol: HTTP
    
    # Logging
    logging:
      enabled: true
      retention: 7d
      level: INFO